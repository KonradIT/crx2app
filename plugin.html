<html>
<head>
<script src="appEnd.js"></script>
<script src="lib/q/q.js"></script>
<script src="Debugger.js"></script>
<script>

function testConnection(connection) {
  connection.attach(function() {
    console.log("Ready ");

    var debuggr = new Debugger(connection);
    var win = debuggr.promiseWindow();
    Q.when(win, function resolved(win) {
      console.log("Window as promised ", win);
      // Experimentally, if the port.disconnect() is called too fast, it races the chrome.windows.create() responses
      connection.detach();
      connection.addListener(null);
    }, function rejected(msgObj) {
      console.error("Debugger.promiseResponse invalid message", msgObj);
    });
  });
}
var connection = getChromeExtensionPipe();
</script>
</head>
<body>
<h1>appEnd test</h1>
<button id='test'  onclick='testConnection(connection)'>Push To Test</button>
<dl id='result'>
</dl>
</body>
<html>